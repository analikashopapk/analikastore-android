name: Android CI (debugging)

on:
  push:
    branches: [ main ]
  workflow_dispatch:

jobs:
  debug-build:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: Show repo root files
        run: |
          echo "=== Repo root listing ==="
          ls -la
          echo "=== End repo root listing ==="

      - name: Show settings files (kts and groovy)
        run: |
          echo "=== settings.gradle.kts content (if exists) ==="
          if [ -f settings.gradle.kts ]; then cat settings.gradle.kts; else echo "(not found)"; fi
          echo "=== settings.gradle content (if exists) ==="
          if [ -f settings.gradle ]; then cat settings.gradle; else echo "(not found)"; fi
          echo "=== End settings content ==="

      - name: Show gradle wrapper files
        run: |
          echo "=== gradle wrapper listing ==="
          if [ -d gradle/wrapper ]; then ls -la gradle/wrapper || true; else echo "(gradle/wrapper missing)"; fi
          echo "=== check gradlew ==="
          if [ -f ./gradlew ]; then echo "gradlew exists"; ls -la ./gradlew; else echo "gradlew MISSING"; fi

      - name: Setup JDK 17
        uses: actions/setup-java@v4
        with:
          distribution: temurin
          java-version: 17

      - name: Make gradlew executable (if exists)
        run: |
          if [ -f ./gradlew ]; then chmod +x ./gradlew; fi
          echo "Done chmod"

      - name: Run ./gradlew projects (to list modules)
        run: |
          if [ -f ./gradlew ]; then
            ./gradlew projects --no-daemon --stacktrace || true
          else
            echo "No gradlew; skipping ./gradlew projects"
            gradle projects || true
          fi

      - name: Attempt assembleDebug
        run: |
          if [ -f ./gradlew ]; then
            ./gradlew :app:assembleDebug --no-daemon --stacktrace
          else
            echo "gradlew missing; attempt system gradle"
            gradle :app:assembleDebug --no-daemon --stacktrace
          fi
